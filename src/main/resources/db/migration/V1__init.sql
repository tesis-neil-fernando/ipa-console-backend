create table events (event_id bigint generated by default as identity, process_id bigint not null, time timestamp(6) with time zone not null, message varchar(255), type varchar(255), primary key (event_id));
create table executions (finished boolean, created_at timestamp(6) with time zone, execution_pk bigint generated by default as identity, started_at timestamp(6) with time zone, stopped_at timestamp(6) with time zone, wait_till timestamp(6) with time zone, execution_id varchar(255) not null unique, mode varchar(255), retry_of varchar(255), retry_success_id varchar(255), status varchar(255), workflow_id varchar(255), raw_json TEXT, primary key (execution_pk));
create table logs (log_id bigint generated by default as identity, process_id bigint not null, time timestamp(6) with time zone not null, user_id bigint, initiator varchar(255), state varchar(255), primary key (log_id));
create table namespaces (namespace_id bigint generated by default as identity, name varchar(120) not null unique, primary key (namespace_id));
create table parameters (parameter_id bigint generated by default as identity, process_id bigint not null, type varchar(100) not null, value varchar(2000) not null, name varchar(255) not null, primary key (parameter_id));
create table permissions (namespace_id bigint, permission_id bigint generated by default as identity, action varchar(20) not null check (action in ('VIEW','EXEC','EDIT')), primary key (permission_id), unique (namespace_id, action));
create table processes (namespace_id bigint, process_id bigint generated by default as identity, workflow_id varchar(64) unique, description varchar(255), name varchar(255) not null, primary key (process_id));
create table role_permissions (permission_id bigint not null, role_id bigint not null, primary key (permission_id, role_id));
create table roles (role_id bigint generated by default as identity, name varchar(100) not null unique, primary key (role_id));
create table sessions (revoked boolean, expires_at timestamp(6), issued_at timestamp(6), last_access_at timestamp(6), session_id bigint generated by default as identity, user_id bigint, ip_address varchar(128), jti varchar(128) not null unique, os varchar(256), user_agent varchar(1024), primary key (session_id));
create table tags (created_at timestamp(6) with time zone, updated_at timestamp(6) with time zone, tag_id varchar(64) not null, name varchar(255) not null, primary key (tag_id));
create table user_roles (role_id bigint not null, user_id bigint not null, primary key (role_id, user_id));
create table users (enabled boolean, user_id bigint generated by default as identity, name varchar(120), username varchar(120) not null unique, password varchar(255), primary key (user_id));
create table workflow_tags (tag_id varchar(64) not null, workflow_id varchar(64) not null, primary key (tag_id, workflow_id));
create table workflows (active boolean not null, is_archived boolean, workflow_id varchar(64) not null, name varchar(255), raw_json text, primary key (workflow_id));
create index idx_events_process on events (process_id);
create index idx_executions_workflow on executions (workflow_id);
create index idx_executions_status on executions (status);
create index idx_executions_created_at on executions (created_at);
create index idx_logs_process on logs (process_id);
create index idx_logs_user on logs (user_id);
create index idx_parameters_process on parameters (process_id);
create index idx_processes_namespace on processes (namespace_id);
create index idx_workflows_active on workflows (active);
alter table if exists events add constraint FKaax409asho8ifh9ipv15snbcq foreign key (process_id) references processes;
alter table if exists executions add constraint FK6t9ajj40rlm67mkceh6ywlo4g foreign key (workflow_id) references workflows;
alter table if exists logs add constraint FK1h2sbvwekrobhiahu614w84y3 foreign key (process_id) references processes;
alter table if exists logs add constraint FKgqy8beil5y4almtq1tiyofije foreign key (user_id) references users;
alter table if exists parameters add constraint FK1y9xfhvrcaqa8fpj8b3i75945 foreign key (process_id) references processes;
alter table if exists permissions add constraint FKonnru6ikonmgq6gmqg4ym0qv6 foreign key (namespace_id) references namespaces;
alter table if exists processes add constraint FKoijy3q4fgwrub22j5aj90v0xj foreign key (namespace_id) references namespaces;
alter table if exists processes add constraint FKbsqsnklhvdkbdvdm5lq4kjk73 foreign key (workflow_id) references workflows;
alter table if exists role_permissions add constraint FKegdk29eiy7mdtefy5c7eirr6e foreign key (permission_id) references permissions;
alter table if exists role_permissions add constraint FKn5fotdgk8d1xvo8nav9uv3muc foreign key (role_id) references roles;
alter table if exists sessions add constraint FKruie73rneumyyd1bgo6qw8vjt foreign key (user_id) references users;
alter table if exists user_roles add constraint FKh8ciramu9cc9q3qcqiv4ue8a6 foreign key (role_id) references roles;
alter table if exists user_roles add constraint FKhfh9dx7w3ubf1co1vdev94g3f foreign key (user_id) references users;
alter table if exists workflow_tags add constraint FK66lc2tfvxux9meu6c2v7fadlh foreign key (tag_id) references tags;
alter table if exists workflow_tags add constraint FKjk3if5e40jgyevxreljpux5g0 foreign key (workflow_id) references workflows;
